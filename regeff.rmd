---
title: "Regeneration effect"
author: "Luke Hayden"
date: "August 1, 2018"
output: html_document
---


```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
library(dplyr)
library(ggbiplot)
library(tibble)
library(tidyr)
library(caret)
library(RColorBrewer)
library(ggrepel)
library(gtools)
````



```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
setwd("~/Documents/nstringjul18")
load(file="allns_data.rdata")
load(file="rfagemodel.rdata")


````




#How does regeneration affect our molecular measure of age?

```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}

md <- as.data.frame(subset(t(ctallgood.norm), sampleinfo$sex == "F" &
                 sampleinfo$exp %in% c("Size-age", "cohorts", "OvY", "regen") & 
                sampleinfo$codeset == "phaw_1" &
                 sampleinfo$type %in% c("O", "Y", "M", "OR")& 
  !(sampleinfo$sample %in% c("T","C", "U", "LFPD", "O1a", "SFPA", "LFIB","LFIA","AF", "Coh8"))))


md$rfagepred <- predict(rfagemodel, newdata= md)

md$sample <- rownames(md)

md <- left_join(md, sampleinfo, by="sample") %>%
  filter(!(is.na(predage)))


ggplot(md, aes(x=predage, y=rfagepred))+
  geom_point(aes(colour=type))+
  xlab("Age (weeks) from body length") +
  ylab("Age (weeks) from marker gene expression (random forest model)")+
  geom_smooth(method="lm", colour="black")+
  theme_bw()+
 scale_colour_manual(values=c("darkviolet", "cornflower blue", "forest green", "red3"))+
  geom_text_repel(aes(label=sample,colour=type), size=2.5)
  ggtitle("How does regeneration affect


````

When we take all markers into account, regeneration does not rejuvenate samples. This fits with previous data. 

#Nikos plot


```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
md <- as.data.frame(ctallgood.norm)

old <- t(subset(t(md), sampleinfo$type =="O" &  
                  sampleinfo$sex == "F" & 
                  sampleinfo$qual =="ok" &
                  sampleinfo$ctg >2))

young <- t(subset(t(md), sampleinfo$type =="Y" & 
                    sampleinfo$sex== "F" & 
                    sampleinfo$qual =="ok"&
                    sampleinfo$ctg >2))

#regen <- md[, sampleinfo$type == "OR"]

regen <- t(subset(t(md), sampleinfo$type =="OR" ))


OR <- foldchange2logratio(foldchange(rowMeans(old), rowMeans(regen)))

OY <- foldchange2logratio(foldchange(rowMeans(old), rowMeans(young)))






oreg <- cbind(old, regen)

t.result <- apply(oreg, 1, function (x)t.test(x[1:ncol(old)],x[ncol(old)+1:ncol(oreg)]))



md$ovreg.pval <- unlist(lapply(t.result, function(x) x$p.value))



vardat$ovregsig <- vardat$ovreg.pval <0.1

ggplot(data=vardat, aes(x=YvOl2fc, y=ROvOl2fc, label=sname))+
  geom_point()+
  geom_hline(yintercept=0, colour="black")+
  geom_vline(xintercept=0, colour="black")+
  theme_bw()+
  xlim(-6,+6)+
  ylim(-6,6)+
  xlab("Young vs Old Log2 Fold Change") +
  ylab("Regenerated vs Old Log2 Fold Change")


```






